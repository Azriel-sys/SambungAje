<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Media Sosial Sederhana</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      /* Variabel CSS untuk tema */
      :root {
        --bg-primary: #fff;
        --bg-secondary: #f8f9fa;
        --text-primary: #262626;
        --text-secondary: #8e8e8e;
        --accent: #0095f6;
        --accent-hover: #1877f2;
        --border: #dbdbdb;
        --card-bg: #fff;
        --shadow: rgba(0, 0, 0, 0.1);
        --google-blue: #4285f4;
        --google-red: #ea4335;
        --chat-bg: #f0f2f5;
        --message-bg: #ffffff;
        --message-bg-own: #d9fdd3;
      }

      /* Dark mode variabel */
      [data-theme="dark"] {
        --bg-primary: #121212;
        --bg-secondary: #1a1a1a;
        --text-primary: #f1f1f1;
        --text-secondary: #a8a8a8;
        --border: #333;
        --card-bg: #1a1a1a;
        --shadow: rgba(255, 255, 255, 0.05);
        --chat-bg: #1f1f1f;
        --message-bg: #2d2d2d;
        --message-bg-own: #015c4b;
      }

      /* Reset dan gaya dasar */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        transition: background-color 0.3s, color 0.3s;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Helvetica, Arial, sans-serif;
        background-color: var(--bg-primary);
        color: var(--text-primary);
        line-height: 1.6;
      }

      a {
        text-decoration: none;
        color: var(--accent);
      }

      button {
        cursor: pointer;
      }

      /* Container utama */
      .container {
        max-width: 100%;
        margin: 0 auto;
        padding-bottom: 60px; /* Ruang untuk navbar bawah */
      }

      /* Header */
      header {
        background-color: var(--bg-primary);
        border-bottom: 1px solid var(--border);
        padding: 10px 20px;
        position: sticky;
        top: 0;
        z-index: 100;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .logo {
        font-size: 1.5rem;
        font-weight: bold;
        color: var(--text-primary);
      }

      .nav-top {
        display: flex;
        align-items: center;
        gap: 15px;
      }

      /* Form styles */
      .form-container {
        max-width: 400px;
        margin: 40px auto;
        padding: 20px;
        background-color: var(--card-bg);
        border: 1px solid var(--border);
        border-radius: 8px;
      }

      .form-title {
        text-align: center;
        margin-bottom: 20px;
        font-size: 1.5rem;
      }

      .form-group {
        margin-bottom: 15px;
      }

      .form-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: 500;
      }

      .form-control {
        width: 100%;
        padding: 10px;
        border: 1px solid var(--border);
        border-radius: 4px;
        background-color: var(--bg-primary);
        color: var(--text-primary);
      }

      .btn {
        display: inline-block;
        padding: 8px 16px;
        border: none;
        border-radius: 4px;
        background-color: var(--accent);
        color: white;
        font-weight: bold;
        margin-top: 10px;
        cursor: pointer;
      }

      .btn:hover {
        background-color: var(--accent-hover);
      }

      .btn-outline {
        background-color: transparent;
        border: 1px solid var(--border);
        color: var(--text-primary);
      }

      .btn-follow {
        background-color: var(--accent);
        color: white;
      }

      .btn-following {
        background-color: transparent;
        border: 1px solid var(--border);
        color: var(--text-primary);
      }

      .btn-google {
        background-color: white;
        color: #757575;
        border: 1px solid #ddd;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        margin-top: 15px;
        width: 100%;
        padding: 10px;
      }

      .btn-google:hover {
        background-color: #f5f5f5;
      }

      .btn-google img {
        width: 18px;
        height: 18px;
      }

      .divider {
        display: flex;
        align-items: center;
        text-align: center;
        margin: 20px 0;
        color: var(--text-secondary);
      }

      .divider::before,
      .divider::after {
        content: "";
        flex: 1;
        border-bottom: 1px solid var(--border);
      }

      .divider::before {
        margin-right: 0.5em;
      }

      .divider::after {
        margin-left: 0.5em;
      }

      /* Post styles */
      .post {
        background-color: var(--card-bg);
        border: 1px solid var(--border);
        border-radius: 8px;
        margin-bottom: 20px;
        overflow: hidden;
      }

      .post-header {
        display: flex;
        align-items: center;
        padding: 10px 15px;
      }

      .post-user-avatar {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        margin-right: 10px;
        object-fit: cover;
      }

      .post-username {
        font-weight: bold;
      }

      .post-time {
        font-size: 0.8rem;
        color: var(--text-secondary);
        margin-left: auto;
      }

      .post-image {
        width: 100%;
        max-height: 500px;
        object-fit: cover;
        cursor: pointer;
      }

      .post-actions {
        padding: 10px 15px;
        display: flex;
        align-items: center;
      }

      .post-action {
        background: none;
        border: none;
        font-size: 1.5rem;
        margin-right: 15px;
        color: var(--text-primary);
      }

      .post-action.liked {
        color: #ed4956;
      }

      .post-likes {
        padding: 0 15px;
        font-weight: bold;
        margin-bottom: 5px;
      }

      .post-caption {
        padding: 0 15px;
        margin-bottom: 10px;
      }

      .post-caption-user {
        font-weight: bold;
        margin-right: 5px;
      }

      .post-comments {
        padding: 0 15px 10px;
      }

      .post-comment {
        margin-bottom: 5px;
        display: flex;
        justify-content: space-between;
      }

      .post-comment-user {
        font-weight: bold;
        margin-right: 5px;
      }

      .post-comment-delete {
        color: #ed4956;
        background: none;
        border: none;
      }

      .post-add-comment {
        display: flex;
        border-top: 1px solid var(--border);
        padding: 10px 15px;
      }

      .comment-input {
        flex: 1;
        padding: 8px;
        border: none;
        background-color: var(--bg-primary);
        color: var(--text-primary);
      }

      .comment-submit {
        background: none;
        border: none;
        color: var(--accent);
        font-weight: bold;
      }

      /* Upload modal */
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
        z-index: 1000;
        align-items: center;
        justify-content: center;
      }

      .modal-content {
        background-color: var(--card-bg);
        border-radius: 12px;
        width: 90%;
        max-width: 500px;
        padding: 20px;
        max-height: 90vh;
        overflow-y: auto;
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
      }

      .modal-close {
        background: none;
        border: none;
        font-size: 1.5rem;
        color: var(--text-primary);
      }

      /* Profile page */
      .profile-header {
        padding: 20px;
        display: flex;
        align-items: center;
        gap: 30px;
        flex-direction: column;
        text-align: center;
      }

      @media (min-width: 768px) {
        .profile-header {
          flex-direction: row;
          text-align: left;
        }
      }

      .profile-avatar-container {
        position: relative;
        width: 100px;
        height: 100px;
      }

      .profile-avatar {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        object-fit: cover;
      }

      .profile-avatar-edit {
        position: absolute;
        bottom: 0;
        right: 0;
        background-color: var(--accent);
        color: white;
        border-radius: 50%;
        width: 30px;
        height: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
      }

      .profile-info {
        flex: 1;
      }

      .profile-info h1 {
        font-size: 1.8rem;
        margin-bottom: 5px;
      }

      .profile-stats {
        display: flex;
        gap: 20px;
        margin: 15px 0;
      }

      .profile-stat {
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .profile-stat-count {
        font-weight: bold;
        font-size: 1.1rem;
      }

      .profile-stat-label {
        font-size: 0.9rem;
        color: var(--text-secondary);
      }

      .profile-bio {
        margin-top: 10px;
        color: var(--text-primary);
        padding: 10px;
        border-radius: 8px;
        background-color: var(--bg-secondary);
      }

      .profile-bio-edit {
        display: none;
        width: 100%;
        padding: 10px;
        border: 1px solid var(--border);
        border-radius: 4px;
        background-color: var(--bg-primary);
        color: var(--text-primary);
        margin-top: 10px;
      }

      .profile-bio.editing .profile-bio-text {
        display: none;
      }

      .profile-bio.editing .profile-bio-edit {
        display: block;
      }

      .profile-bio-actions {
        display: flex;
        gap: 10px;
        margin-top: 10px;
      }

      .profile-divider {
        height: 1px;
        background-color: var(--border);
        margin: 20px 0;
      }

      .profile-posts {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 2px;
      }

      .profile-post {
        aspect-ratio: 1/1;
        overflow: hidden;
        position: relative;
        cursor: pointer;
      }

      .profile-post img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      .profile-post-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.3);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 20px;
        color: white;
        opacity: 0;
        transition: opacity 0.3s;
      }

      .profile-post:hover .profile-post-overlay {
        opacity: 1;
      }

      .profile-post-stat {
        display: flex;
        align-items: center;
        gap: 5px;
      }

      /* Bottom navigation */
      .nav-bottom {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        background-color: var(--bg-primary);
        border-top: 1px solid var(--border);
        display: flex;
        justify-content: space-around;
        padding: 10px 0;
        z-index: 100;
      }

      .nav-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        color: var(--text-secondary);
        font-size: 0.8rem;
      }

      .nav-item.active {
        color: var(--text-primary);
      }

      .nav-icon {
        font-size: 1.5rem;
        margin-bottom: 3px;
      }

      /* Top navigation for desktop */
      .nav-top-menu {
        display: none;
      }

      @media (min-width: 768px) {
        .nav-top-menu {
          display: flex;
          gap: 20px;
          margin-right: 20px;
        }

        .nav-top-menu-item {
          color: var(--text-primary);
          font-size: 1.2rem;
        }

        .nav-bottom {
          display: none;
        }
      }

      /* Chat styles */
      .chat-container {
        position: fixed;
        bottom: 80px;
        right: 20px;
        width: 350px;
        height: 450px;
        background-color: var(--card-bg);
        border: 1px solid var(--border);
        border-radius: 12px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        display: flex;
        flex-direction: column;
        z-index: 99;
        overflow: hidden;
        transform: translateY(100%);
        opacity: 0;
        transition: transform 0.3s ease, opacity 0.3s ease;
      }

      .chat-container.open {
        transform: translateY(0);
        opacity: 1;
      }

      .chat-header {
        padding: 15px;
        border-bottom: 1px solid var(--border);
        display: flex;
        justify-content: space-between;
        align-items: center;
        background-color: var(--bg-primary);
      }

      .chat-title {
        font-weight: bold;
        font-size: 1.1rem;
      }

      .chat-close {
        background: none;
        border: none;
        font-size: 1.2rem;
        color: var(--text-primary);
      }

      .chat-users {
        padding: 10px;
        border-bottom: 1px solid var(--border);
        overflow-x: auto;
        display: flex;
        gap: 10px;
        background-color: var(--bg-primary);
      }

      .chat-user {
        display: flex;
        flex-direction: column;
        align-items: center;
        cursor: pointer;
        padding: 5px;
        border-radius: 8px;
        min-width: 60px;
      }

      .chat-user.active {
        background-color: var(--bg-secondary);
      }

      .chat-user-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        object-fit: cover;
        margin-bottom: 5px;
      }

      .chat-user-name {
        font-size: 0.7rem;
        text-align: center;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        max-width: 60px;
      }

      .chat-messages {
        flex: 1;
        padding: 15px;
        overflow-y: auto;
        background-color: var(--chat-bg);
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .chat-message {
        display: flex;
        gap: 8px;
        max-width: 80%;
      }

      .chat-message.own {
        align-self: flex-end;
        flex-direction: row-reverse;
      }

      .chat-message-avatar {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        object-fit: cover;
        flex-shrink: 0;
      }

      .chat-message-content {
        background-color: var(--message-bg);
        padding: 10px 12px;
        border-radius: 18px;
        font-size: 0.9rem;
      }

      .chat-message.own .chat-message-content {
        background-color: var(--message-bg-own);
      }

      .chat-message-time {
        font-size: 0.7rem;
        color: var(--text-secondary);
        margin-top: 5px;
        text-align: right;
      }

      .chat-input-container {
        padding: 10px;
        border-top: 1px solid var(--border);
        background-color: var(--bg-primary);
        display: flex;
        gap: 10px;
      }

      .chat-input {
        flex: 1;
        padding: 10px;
        border: 1px solid var(--border);
        border-radius: 20px;
        background-color: var(--bg-primary);
        color: var(--text-primary);
      }

      .chat-send {
        background: none;
        border: none;
        color: var(--accent);
        font-size: 1.2rem;
      }

      .chat-toggle {
        position: fixed;
        bottom: 90px;
        right: 20px;
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background-color: var(--accent);
        color: white;
        border: none;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        z-index: 98;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
      }

      .chat-notification {
        position: absolute;
        top: -5px;
        right: -5px;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background-color: #ed4956;
        color: white;
        font-size: 0.7rem;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      /* Utility classes */
      .hidden {
        display: none !important;
      }

      .text-center {
        text-align: center;
      }

      .mt-20 {
        margin-top: 20px;
      }

      /* Dark mode toggle */
      .theme-toggle {
        background: none;
        border: none;
        color: var(--text-primary);
        font-size: 1.2rem;
        cursor: pointer;
      }

      /* Responsive styles */
      @media (min-width: 768px) {
        .container {
          max-width: 600px;
        }

        .profile-posts {
          gap: 20px;
          border-top: 1px solid var(--border);
          padding-top: 20px;
        }

        .profile-post {
          border-radius: 8px;
          border: 1px solid var(--border);
        }
      }

      @media (max-width: 768px) {
        .chat-container {
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          border-radius: 0;
          bottom: auto;
          right: auto;
        }

        .chat-toggle {
          bottom: 80px;
          right: 20px;
        }
      }

      /* Animations */
      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      .fade-in {
        animation: fadeIn 0.5s ease-in;
      }

      .heart-animation {
        animation: heartBeat 0.5s ease;
      }

      @keyframes heartBeat {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.3);
        }
        100% {
          transform: scale(1);
        }
      }

      /* Loading spinner */
      .spinner {
        border: 3px solid #f3f3f3;
        border-top: 3px solid var(--accent);
        border-radius: 50%;
        width: 30px;
        height: 30px;
        animation: spin 1s linear infinite;
        margin: 20px auto;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      /* Post detail modal */
      .post-detail {
        display: flex;
        flex-direction: column;
      }

      @media (min-width: 768px) {
        .post-detail {
          flex-direction: row;
        }
      }

      .post-detail-image {
        width: 100%;
        max-height: 400px;
        object-fit: cover;
      }

      @media (min-width: 768px) {
        .post-detail-image {
          width: 50%;
          max-height: none;
        }
      }

      .post-detail-content {
        padding: 15px;
        width: 100%;
      }

      @media (min-width: 768px) {
        .post-detail-content {
          width: 50%;
          max-height: 400px;
          overflow-y: auto;
        }
      }

      .post-detail-header {
        display: flex;
        align-items: center;
        margin-bottom: 15px;
      }

      .post-detail-user-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        margin-right: 10px;
        object-fit: cover;
      }

      .post-detail-username {
        font-weight: bold;
      }

      .post-detail-caption {
        margin-bottom: 15px;
      }

      .post-detail-comments {
        margin-top: 15px;
      }

      .post-detail-comment {
        margin-bottom: 10px;
        padding-bottom: 10px;
        border-bottom: 1px solid var(--border);
      }

      .post-detail-comment-user {
        font-weight: bold;
        margin-right: 5px;
      }
    </style>
  </head>
  <body>
    <!-- Header dengan logo dan navigasi -->
    <header>
      <div class="logo">Sambung Aje</div>
      <div class="nav-top">
        <div class="nav-top-menu">
          <a href="#" class="nav-top-menu-item active" data-page="homePage">
            <i class="fas fa-home"></i>
          </a>
          <a href="#" class="nav-top-menu-item" data-page="uploadPage">
            <i class="fas fa-plus-square"></i>
          </a>
          <a href="#" class="nav-top-menu-item" data-page="profilePage">
            <i class="fas fa-user"></i>
          </a>
        </div>
        <button class="theme-toggle" id="themeToggle">
          <i class="fas fa-moon"></i>
        </button>
        <div id="authButtons">
          <a href="#" class="btn btn-outline" id="loginBtn">Masuk</a>
          <a href="#" class="btn" id="registerBtn">Daftar</a>
        </div>
        <div id="userMenu" class="hidden">
          <a href="#" id="profileLink"><i class="fas fa-user"></i></a>
          <button id="logoutBtn" class="btn btn-outline">Keluar</button>
        </div>
      </div>
    </header>

    <!-- Container utama -->
    <div class="container">
      <!-- Halaman Login -->
      <div id="loginPage" class="hidden">
        <div class="form-container">
          <h2 class="form-title">Masuk ke Sogram</h2>
          <form id="loginForm">
            <div class="form-group">
              <label for="loginEmail">Email atau Username</label>
              <input
                type="text"
                id="loginEmail"
                class="form-control"
                required
              />
            </div>
            <div class="form-group">
              <label for="loginPassword">Password</label>
              <input
                type="password"
                id="loginPassword"
                class="form-control"
                required
              />
            </div>
            <button type="submit" class="btn">Masuk</button>
          </form>

          <div class="divider">ATAU</div>

          <button class="btn btn-google" id="googleLogin">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 48 48"
              width="24px"
              height="24px"
            >
              <path
                fill="#FFC107"
                d="M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12c0-6.627,5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24c0,11.045,8.955,20,20,20c11.045,0,20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z"
              />
              <path
                fill="#FF3D00"
                d="M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z"
              />
              <path
                fill="#4CAF50"
                d="M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36c-5.202,0-9.619-3.317-11.283-7.946l-6.522,5.025C9.505,39.556,16.227,44,24,44z"
              />
              <path
                fill="#1976D2"
                d="M43.611,20.083H42V20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.571c0.001-0.001,0.002-0.001,0.003-0.002l6.19,5.238C36.971,39.205,44,34,44,24C44,22.659,43.862,21.35,43.611,20.083z"
              />
            </svg>
            Masuk dengan Google
          </button>

          <p class="text-center mt-20">
            Belum punya akun? <a href="#" id="goToRegister">Daftar di sini</a>
          </p>
        </div>
      </div>

      <!-- Halaman Register -->
      <div id="registerPage" class="hidden">
        <div class="form-container">
          <h2 class="form-title">Buat Akun Baru</h2>
          <form id="registerForm">
            <div class="form-group">
              <label for="registerEmail">Email</label>
              <input
                type="email"
                id="registerEmail"
                class="form-control"
                required
              />
            </div>
            <div class="form-group">
              <label for="registerUsername">Username</label>
              <input
                type="text"
                id="registerUsername"
                class="form-control"
                required
              />
            </div>
            <div class="form-group">
              <label for="registerPassword">Password</label>
              <input
                type="password"
                id="registerPassword"
                class="form-control"
                required
              />
            </div>
            <button type="submit" class="btn">Daftar</button>
          </form>

          <div class="divider">ATAU</div>

          <button class="btn btn-google" id="googleRegister">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 48 48"
              width="24px"
              height="24px"
            >
              <path
                fill="#FFC107"
                d="M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12c0-6.627,5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z"
              />
              <path
                fill="#FF3D00"
                d="M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z"
              />
              <path
                fill="#4CAF50"
                d="M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36c-5.202,0-9.619-3.317-11.283-7.946l-6.522,5.025C9.505,39.556,16.227,44,24,44z"
              />
              <path
                fill="#1976D2"
                d="M43.611,20.083H42V20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.571c0.001-0.001,0.002-0.001,0.003-0.002l6.19,5.238C36.971,39.205,44,34,44,24C44,22.659,43.862,21.35,43.611,20.083z"
              />
            </svg>
            Daftar dengan Google
          </button>

          <p class="text-center mt-20">
            Sudah punya akun? <a href="#" id="goToLogin">Masuk di sini</a>
          </p>
        </div>
      </div>

      <!-- Halaman Feed/Home -->
      <div id="homePage" class="hidden">
        <div id="postsContainer">
          <!-- Postingan akan dimuat di sini melalui JavaScript -->
        </div>
      </div>

      <!-- Halaman Upload -->
      <div id="uploadPage" class="hidden">
        <div class="form-container">
          <h2 class="form-title">Unggah Foto Baru</h2>
          <form id="uploadForm">
            <div class="form-group">
              <label for="postImage">Pilih Foto</label>
              <input
                type="file"
                id="postImage"
                accept="image/*"
                class="form-control"
                required
              />
            </div>
            <div class="form-group">
              <label for="postCaption">Caption</label>
              <textarea
                id="postCaption"
                class="form-control"
                rows="3"
                placeholder="Tulis caption..."
              ></textarea>
            </div>
            <button type="submit" class="btn">Unggah</button>
          </form>
        </div>
      </div>

      <!-- Halaman Profil -->
      <div id="profilePage" class="hidden">
        <div class="profile-header">
          <div class="profile-avatar-container">
            <img
              src="https://via.placeholder.com/100"
              alt="Avatar"
              class="profile-avatar"
              id="profileAvatar"
            />
            <div class="profile-avatar-edit" id="profileAvatarEdit">
              <i class="fas fa-camera"></i>
            </div>
            <input
              type="file"
              id="profileAvatarInput"
              accept="image/*"
              class="hidden"
            />
          </div>
          <div class="profile-info">
            <h1 id="profileUsername">username</h1>
            <div class="profile-stats">
              <div class="profile-stat">
                <span class="profile-stat-count" id="postsCount">0</span>
                <span class="profile-stat-label">Postingan</span>
              </div>
              <div class="profile-stat">
                <span class="profile-stat-count" id="followersCount">0</span>
                <span class="profile-stat-label">Pengikut</span>
              </div>
              <div class="profile-stat">
                <span class="profile-stat-count" id="followingCount">0</span>
                <span class="profile-stat-label">Mengikuti</span>
              </div>
            </div>
            <button class="btn btn-follow hidden" id="followButton">
              Ikuti
            </button>
            <div class="profile-bio" id="profileBio">
              <div class="profile-bio-text" id="profileBioText">
                Bio pengguna akan muncul di sini.
              </div>
              <textarea
                class="profile-bio-edit"
                id="profileBioEdit"
                placeholder="Tulis bio Anda..."
              ></textarea>
              <div class="profile-bio-actions hidden" id="profileBioActions">
                <button class="btn" id="profileBioSave">Simpan</button>
                <button class="btn btn-outline" id="profileBioCancel">
                  Batal
                </button>
              </div>
            </div>
          </div>
        </div>
        <div class="profile-divider"></div>
        <div class="profile-posts" id="profilePosts">
          <!-- Postingan profil akan dimuat di sini -->
        </div>
      </div>
    </div>

    <!-- Modal untuk preview gambar -->
    <div class="modal" id="imageModal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Detail Postingan</h2>
          <button class="modal-close">&times;</button>
        </div>
        <div class="post-detail" id="postDetail">
          <!-- Detail postingan akan dimuat di sini -->
        </div>
      </div>
    </div>

    <!-- Modal untuk upload foto profil -->
    <div class="modal" id="avatarModal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Ubah Foto Profil</h2>
          <button class="modal-close">&times;</button>
        </div>
        <div class="form-group">
          <label for="avatarUpload">Pilih Foto</label>
          <input
            type="file"
            id="avatarUpload"
            accept="image/*"
            class="form-control"
            required
          />
        </div>
        <button class="btn" id="avatarSave">Simpan</button>
        <button
          class="btn btn-outline"
          id="avatarDelete"
          style="margin-left: 10px"
        >
          Hapus Foto
        </button>
      </div>
    </div>

    <!-- Navigasi Bawah untuk Mobile -->
    <div class="nav-bottom">
      <div class="nav-item active" data-page="homePage">
        <i class="fas fa-home nav-icon"></i>
        <span>Home</span>
      </div>
      <div class="nav-item" data-page="uploadPage">
        <i class="fas fa-plus-square nav-icon"></i>
        <span>Upload</span>
      </div>
      <div class="nav-item" data-page="profilePage">
        <i class="fas fa-user nav-icon"></i>
        <span>Profil</span>
      </div>
    </div>

    <!-- Chat Toggle Button -->
    <button class="chat-toggle hidden" id="chatToggle">
      <i class="fas fa-comment"></i>
      <span class="chat-notification hidden" id="chatNotification">3</span>
    </button>

    <!-- Chat Container -->
    <div class="chat-container" id="chatContainer">
      <div class="chat-header">
        <div class="chat-title">Pesan</div>
        <button class="chat-close" id="chatClose">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="chat-users" id="chatUsers">
        <!-- Daftar user chat akan dimuat di sini -->
      </div>
      <div class="chat-messages" id="chatMessages">
        <!-- Pesan akan dimuat di sini -->
      </div>
      <div class="chat-input-container">
        <input
          type="text"
          class="chat-input"
          id="chatInput"
          placeholder="Ketik pesan..."
        />
        <button class="chat-send" id="chatSend">
          <i class="fas fa-paper-plane"></i>
        </button>
      </div>
    </div>

    <!-- Toast Notification -->
    <div
      id="toastNotification"
      style="
        position: fixed;
        left: 50%;
        transform: translateX(-50%);
        bottom: 30px;
        min-width: 220px;
        background: #323232;
        color: #fff;
        padding: 14px 24px;
        border-radius: 8px;
        font-size: 1rem;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        z-index: 9999;
        display: none;
        align-items: center;
        gap: 10px;
      "
    >
      <i class="fas fa-bell"></i>
      <span id="toastMessage"></span>
    </div>
    <script>
      // Data contoh untuk demo
      let users = JSON.parse(localStorage.getItem("users")) || [];
      let posts = JSON.parse(localStorage.getItem("posts")) || [];
      let currentUser = JSON.parse(localStorage.getItem("currentUser")) || null;
      let isPublicMode = localStorage.getItem("isPublicMode") !== "false"; // Default true (public)
      let chats = JSON.parse(localStorage.getItem("chats")) || [];
      let currentChatUser = null;
      let viewingProfileUserId = null; // Untuk melihat profil user lain

      // DOM Elements
      const themeToggle = document.getElementById("themeToggle");
      const authButtons = document.getElementById("authButtons");
      const userMenu = document.getElementById("userMenu");
      const profileLink = document.getElementById("profileLink");
      const logoutBtn = document.getElementById("logoutBtn");
      const googleLogin = document.getElementById("googleLogin");
      const googleRegister = document.getElementById("googleRegister");
      const chatToggle = document.getElementById("chatToggle");
      const chatContainer = document.getElementById("chatContainer");
      const chatClose = document.getElementById("chatClose");
      const chatUsers = document.getElementById("chatUsers");
      const chatMessages = document.getElementById("chatMessages");
      const chatInput = document.getElementById("chatInput");
      const chatSend = document.getElementById("chatSend");
      const chatNotification = document.getElementById("chatNotification");
      const profileAvatarEdit = document.getElementById("profileAvatarEdit");
      const profileAvatarInput = document.getElementById("profileAvatarInput");
      const avatarModal = document.getElementById("avatarModal");
      const avatarUpload = document.getElementById("avatarUpload");
      const avatarSave = document.getElementById("avatarSave");
      const followButton = document.getElementById("followButton");
      const profileBio = document.getElementById("profileBio");
      const profileBioText = document.getElementById("profileBioText");
      const profileBioEdit = document.getElementById("profileBioEdit");
      const profileBioActions = document.getElementById("profileBioActions");
      const profileBioSave = document.getElementById("profileBioSave");
      const profileBioCancel = document.getElementById("profileBioCancel");
      const navTopMenuItems = document.querySelectorAll(".nav-top-menu-item");

      // Pages
      const loginPage = document.getElementById("loginPage");
      const registerPage = document.getElementById("registerPage");
      const homePage = document.getElementById("homePage");
      const uploadPage = document.getElementById("uploadPage");
      const profilePage = document.getElementById("profilePage");

      // Forms
      const loginForm = document.getElementById("loginForm");
      const registerForm = document.getElementById("registerForm");
      const uploadForm = document.getElementById("uploadForm");

      // Other elements
      const postsContainer = document.getElementById("postsContainer");
      const profilePosts = document.getElementById("profilePosts");
      const navItems = document.querySelectorAll(".nav-item");
      const modal = document.getElementById("imageModal");
      const postDetail = document.getElementById("postDetail");
      const modalClose = document.querySelector(".modal-close");

      // Initialize the app
      function init() {
        // Check if we have users, if not create a demo user
        if (users.length === 0) {
          const demoUser = {
            id: 1,
            email: "demo@example.com",
            username: "demo",
            password: "password", // In a real app, this would be hashed
            avatar: "https://via.placeholder.com/100",
            bio: "Ini adalah akun demo",
            followers: 100,
            following: 50,
            isOnline: true,
            followersList: [2, 3],
            followingList: [2, 3],
          };

          const demoUser2 = {
            id: 2,
            email: "user2@example.com",
            username: "sarah_",
            password: "password",
            avatar: "https://i.pravatar.cc/150?u=2",
            bio: "Hai! Saya Sarah",
            followers: 250,
            following: 120,
            isOnline: true,
            followersList: [1, 3],
            followingList: [1],
          };

          const demoUser3 = {
            id: 3,
            email: "user3@example.com",
            username: "john_doe",
            password: "password",
            avatar: "https://i.pravatar.cc/150?u=3",
            bio: "Photographer & traveler",
            followers: 520,
            following: 210,
            isOnline: false,
            followersList: [1, 2],
            followingList: [1],
          };

          users.push(demoUser, demoUser2, demoUser3);
          localStorage.setItem("users", JSON.stringify(users));

          // Create demo posts
          const demoPosts = [
            {
              id: 1,
              userId: 1,
              image: "https://picsum.photos/600/600?random=1",
              caption: "Ini adalah postingan demo pertama! #demo",
              likes: 15,
              likedBy: [2, 3],
              comments: [
                { userId: 2, username: "sarah_", text: "Keren!" },
                { userId: 3, username: "john_doe", text: "Bagus sekali!" },
              ],
              timestamp: new Date().getTime() - 1000 * 60 * 60 * 24, // 1 day ago
            },
            {
              id: 2,
              userId: 1,
              image: "https://picsum.photos/600/600?random=2",
              caption:
                "Postingan demo kedua dengan caption yang lebih panjang untuk menunjukkan bagaimana tampilannya di feed.",
              likes: 8,
              likedBy: [2],
              comments: [],
              timestamp: new Date().getTime() - 1000 * 60 * 60 * 2, // 2 hours ago
            },
            {
              id: 3,
              userId: 2,
              image: "https://picsum.photos/600/600?random=3",
              caption: "Sunset yang indah hari ini! 🌅 #sunset #nature",
              likes: 42,
              likedBy: [1, 3],
              comments: [
                { userId: 1, username: "demo", text: "Lokasi dimana?" },
              ],
              timestamp: new Date().getTime() - 1000 * 60 * 60 * 5, // 5 hours ago
            },
          ];

          posts = demoPosts;
          localStorage.setItem("posts", JSON.stringify(posts));

          // Create demo chats
          const demoChats = [
            {
              id: 1,
              participants: [1, 2],
              messages: [
                {
                  id: 1,
                  senderId: 2,
                  text: "Hai! Postingan kamu bagus sekali!",
                  timestamp: new Date().getTime() - 1000 * 60 * 60 * 3,
                },
                {
                  id: 2,
                  senderId: 1,
                  text: "Terima kasih! Postingan sunset kamu juga keren banget",
                  timestamp: new Date().getTime() - 1000 * 60 * 60 * 2,
                },
                {
                  id: 3,
                  senderId: 2,
                  text: "Lain kali kita jalan-jalan bareng ya, biar bisa foto-foto bersama",
                  timestamp: new Date().getTime() - 1000 * 60 * 60 * 1,
                },
              ],
            },
            {
              id: 2,
              participants: [1, 3],
              messages: [
                {
                  id: 1,
                  senderId: 3,
                  text: "Halo, saya tertarik dengan karya fotografi kamu",
                  timestamp: new Date().getTime() - 1000 * 60 * 60 * 10,
                },
                {
                  id: 2,
                  senderId: 1,
                  text: "Hai John! Terima kasih, karya kamu juga bagus-bagus",
                  timestamp: new Date().getTime() - 1000 * 60 * 60 * 9,
                },
              ],
            },
          ];

          chats = demoChats;
          localStorage.setItem("chats", JSON.stringify(chats));
        }

        // Check current user and update UI
        updateUI();

        // Load posts
        loadPosts();
      }

      // Update UI based on authentication state
      function updateUI() {
        if (currentUser) {
          authButtons.classList.add("hidden");
          userMenu.classList.remove("hidden");
          chatToggle.classList.remove("hidden");
          profileLink.innerHTML = `<i class="fas fa-user"></i> ${currentUser.username}`;

          // Load chat users
          loadChatUsers();

          // Show content pages if logged in
          if (
            !homePage.classList.contains("hidden") ||
            !uploadPage.classList.contains("hidden") ||
            !profilePage.classList.contains("hidden")
          ) {
            // Already on a content page
          } else {
            showPage("homePage");
          }
        } else {
          authButtons.classList.remove("hidden");
          userMenu.classList.add("hidden");
          chatToggle.classList.add("hidden");
          chatContainer.classList.remove("open");

          if (isPublicMode) {
            showPage("homePage");
          } else {
            showPage("loginPage");
          }
        }

        // Update profile page if needed
        if (!profilePage.classList.contains("hidden")) {
          loadProfilePage();
        }

        // Update notification badge
        updateChatNotification();
      }

      // Show a specific page
      function showPage(pageId) {
        // Hide all pages
        loginPage.classList.add("hidden");
        registerPage.classList.add("hidden");
        homePage.classList.add("hidden");
        uploadPage.classList.add("hidden");
        profilePage.classList.add("hidden");

        // Show the requested page
        document.getElementById(pageId).classList.remove("hidden");

        // Update bottom navigation
        navItems.forEach((item) => {
          if (item.getAttribute("data-page") === pageId) {
            item.classList.add("active");
          } else {
            item.classList.remove("active");
          }
        });

        // Update top navigation
        navTopMenuItems.forEach((item) => {
          if (item.getAttribute("data-page") === pageId) {
            item.classList.add("active");
          } else {
            item.classList.remove("active");
          }
        });

        // Load page-specific content
        if (pageId === "homePage") {
          loadPosts();
        } else if (pageId === "profilePage") {
          viewingProfileUserId = null; // Reset to current user's profile
          loadProfilePage();
        }
      }

      // Load posts into the feed
      function loadPosts() {
        // Clear existing posts
        postsContainer.innerHTML = "";

        // Sort posts by timestamp (newest first)
        const sortedPosts = [...posts].sort(
          (a, b) => b.timestamp - a.timestamp
        );

        if (sortedPosts.length === 0) {
          postsContainer.innerHTML =
            '<div class="text-center">Tidak ada postingan yang ditemukan</div>';
          return;
        }

        // Create post elements
        sortedPosts.forEach((post) => {
          const user = users.find((u) => u.id === post.userId);
          if (!user) return;

          const postElement = document.createElement("div");
          postElement.className = "post fade-in";
          postElement.innerHTML = `
                    <div class="post-header">
                        <img src="${user.avatar}" alt="${
            user.username
          }" class="post-user-avatar">
                        <span class="post-username">${user.username}</span>
                        <span class="post-time">${formatTime(
                          post.timestamp
                        )}</span>
                        ${
                          currentUser && post.userId === currentUser.id
                            ? `<button class="post-delete-btn" data-post-id="${post.id}" title="Hapus Postingan" style="background:none;border:none;color:#ed4956;font-size:1.2rem;float:right;"><i class="fas fa-trash"></i></button>`
                            : ""
                        }
                    </div>
                    <img src="${
                      post.image
                    }" alt="Post image" class="post-image" data-post-id="${
            post.id
          }">
                    <div class="post-actions">
                        <button class="post-action like-btn ${
                          isPostLiked(post) ? "liked" : ""
                        }" data-post-id="${post.id}">
                            <i class="fas fa-heart"></i>
                        </button>
                        <button class="post-action comment-btn" data-post-id="${
                          post.id
                        }">
                            <i class="fas fa-comment"></i>
                        </button>
                    </div>
                    <div class="post-likes">${post.likes} suka</div>
                    <div class="post-caption">
                        <span class="post-caption-user">${user.username}</span>
                        ${post.caption}
                    </div>
                    <div class="post-comments">
                        ${post.comments
                          .slice(0, 2)
                          .map(
                            (comment) => `
                            <div class="post-comment">
                                <div>
                                    <span class="post-comment-user">${
                                      comment.username
                                    }</span>
                                    ${comment.text}
                                </div>
                                ${
                                  currentUser &&
                                  (currentUser.id === comment.userId ||
                                    currentUser.id === post.userId)
                                    ? `<button class="post-comment-delete" data-post-id="${post.id}" data-comment-id="${comment.id}">
                                        <i class="fas fa-trash"></i>
                                    </button>`
                                    : ""
                                }
                            </div>
                        `
                          )
                          .join("")}
                        ${
                          post.comments.length > 2
                            ? `<button class="view-all-comments" data-post-id="${post.id}">
                                Lihat semua ${post.comments.length} komentar
                            </button>`
                            : ""
                        }
                    </div>
                    ${
                      currentUser
                        ? `
                    <div class="post-add-comment">
                        <input type="text" class="comment-input" placeholder="Tambahkan komentar..." data-post-id="${post.id}">
                        <button class="comment-submit" data-post-id="${post.id}">Kirim</button>
                    </div>
                    `
                        : ""
                    }
                `;

          postsContainer.appendChild(postElement);

          if (currentUser) {
            postElement.querySelectorAll(".post-delete-btn").forEach((btn) => {
              btn.addEventListener("click", function (e) {
                e.stopPropagation();
                const postId = parseInt(btn.getAttribute("data-post-id"));
                if (confirm("Yakin ingin menghapus postingan ini?")) {
                  posts = posts.filter((p) => p.id !== postId);
                  localStorage.setItem("posts", JSON.stringify(posts));
                  loadPosts();
                  if (typeof loadProfilePage === "function") loadProfilePage();
                }
              });
            });
          }
        });

        // Add event listeners for like buttons
        document.querySelectorAll(".like-btn").forEach((btn) => {
          btn.addEventListener("click", handleLike);
        });

        // Add event listeners for comment submission
        document.querySelectorAll(".comment-submit").forEach((btn) => {
          btn.addEventListener("click", handleCommentSubmit);
        });

        // Add event listeners for comment input enter key
        document.querySelectorAll(".comment-input").forEach((input) => {
          input.addEventListener("keypress", (e) => {
            if (e.key === "Enter") {
              handleCommentSubmit(e);
            }
          });
        });

        // Add event listeners for delete comment buttons
        document.querySelectorAll(".post-comment-delete").forEach((btn) => {
          btn.addEventListener("click", handleDeleteComment);
        });

        // Add event listeners for post image click
        document.querySelectorAll(".post-image").forEach((img) => {
          img.addEventListener("click", (e) => {
            const postId = parseInt(e.target.getAttribute("data-post-id"));
            showPostDetail(postId);
          });
        });
      }

      // Load profile page
      function loadProfilePage() {
        const profileUser = viewingProfileUserId
          ? users.find((u) => u.id === viewingProfileUserId)
          : currentUser;

        if (!profileUser) return;

        // Update profile info
        document.getElementById("profileUsername").textContent =
          profileUser.username;
        document.getElementById("profileAvatar").src = profileUser.avatar;
        document.getElementById("profileBioText").textContent =
          profileUser.bio || "Tidak ada bio";
        document.getElementById("postsCount").textContent = posts.filter(
          (p) => p.userId === profileUser.id
        ).length;
        document.getElementById("followersCount").textContent =
          profileUser.followers || 0;
        document.getElementById("followingCount").textContent =
          profileUser.following || 0;

        // Show/hide follow button
        if (currentUser && currentUser.id !== profileUser.id) {
          followButton.classList.remove("hidden");
          if (isFollowing(currentUser, profileUser.id)) {
            followButton.textContent = "Mengikuti";
            followButton.classList.remove("btn-follow");
            followButton.classList.add("btn-following");
          } else {
            followButton.textContent = "Ikuti";
            followButton.classList.add("btn-follow");
            followButton.classList.remove("btn-following");
          }
        } else {
          followButton.classList.add("hidden");
        }

        // Show/hide bio edit features
        if (currentUser && currentUser.id === profileUser.id) {
          profileBio.style.cursor = "pointer";
          profileBio.title = "Klik untuk mengedit bio";
        } else {
          profileBio.style.cursor = "default";
          profileBio.title = "";
        }

        // Load user's posts
        const userPosts = posts.filter((p) => p.userId === profileUser.id);
        profilePosts.innerHTML = "";

        if (userPosts.length === 0) {
          profilePosts.innerHTML =
            '<div class="text-center">Belum ada postingan</div>';
          return;
        }

        userPosts.forEach((post) => {
          const postElement = document.createElement("div");
          postElement.className = "profile-post";
          postElement.innerHTML = `
                    <img src="${post.image}" alt="Post image" data-post-id="${
            post.id
          }">
                    <div class="profile-post-overlay">
                        <div class="profile-post-stat">
                            <i class="fas fa-heart"></i>
                            <span>${post.likes}</span>
                        </div>
                        <div class="profile-post-stat">
                            <i class="fas fa-comment"></i>
                            <span>${post.comments.length}</span>
                        </div>
                        ${
                          currentUser && post.userId === currentUser.id
                            ? `<button class="profile-post-delete-btn" data-post-id="${post.id}" title="Hapus Postingan" style="background:none;border:none;color:#ed4956;font-size:1.2rem;"><i class="fas fa-trash"></i></button>`
                            : ""
                        }
                    </div>
                `;
          profilePosts.appendChild(postElement);

          // Add click event to view post
          postElement.querySelector("img").addEventListener("click", () => {
            showPostDetail(post.id);
          });
        });

        if (currentUser && post.userId === currentUser.id) {
          postElement
            .querySelectorAll(".profile-post-delete-btn")
            .forEach((btn) => {
              btn.addEventListener("click", function (e) {
                e.stopPropagation();
                const postId = parseInt(btn.getAttribute("data-post-id"));
                if (confirm("Yakin ingin menghapus postingan ini?")) {
                  posts = posts.filter((p) => p.id !== postId);
                  localStorage.setItem("posts", JSON.stringify(posts));
                  loadProfilePage();
                  if (typeof loadPosts === "function") loadPosts();
                }
              });
            });
        }
      }

      // Check if current user is following another user
      function isFollowing(user, targetUserId) {
        return user.followingList && user.followingList.includes(targetUserId);
      }

      // Handle follow button click
      function handleFollow() {
        if (!currentUser || !viewingProfileUserId) return;

        const targetUser = users.find((u) => u.id === viewingProfileUserId);
        if (!targetUser) return;

        if (isFollowing(currentUser, viewingProfileUserId)) {
          // Unfollow
          currentUser.followingList = currentUser.followingList.filter(
            (id) => id !== viewingProfileUserId
          );
          currentUser.following--;

          targetUser.followersList = targetUser.followersList.filter(
            (id) => id !== currentUser.id
          );
          targetUser.followers--;
        } else {
          // Follow
          if (!currentUser.followingList) currentUser.followingList = [];
          currentUser.followingList.push(viewingProfileUserId);
          currentUser.following++;

          if (!targetUser.followersList) targetUser.followersList = [];
          targetUser.followersList.push(currentUser.id);
          targetUser.followers++;
        }

        // Update UI
        loadProfilePage();

        // Save to localStorage
        localStorage.setItem("users", JSON.stringify(users));
        localStorage.setItem("currentUser", JSON.stringify(currentUser));
      }

      // Show post detail in modal
      function showPostDetail(postId) {
        const post = posts.find((p) => p.id === postId);
        if (!post) return;

        const user = users.find((u) => u.id === post.userId);
        if (!user) return;

        postDetail.innerHTML = `
                <img src="${
                  post.image
                }" alt="Post image" class="post-detail-image">
                <div class="post-detail-content">
                    <div class="post-detail-header">
                        <img src="${user.avatar}" alt="${
          user.username
        }" class="post-detail-user-avatar">
                        <div class="post-detail-username">${user.username}</div>
                    </div>
                    <div class="post-detail-caption">
                        <span class="post-caption-user">${user.username}</span>
                        ${post.caption}
                    </div>
                    <div class="post-likes">${post.likes} suka</div>
                    <div class="post-detail-comments">
                        ${post.comments
                          .map(
                            (comment) => `
                            <div class="post-detail-comment">
                                <div>
                                    <span class="post-detail-comment-user">${comment.username}</span>
                                    ${comment.text}
                                </div>
                            </div>
                        `
                          )
                          .join("")}
                    </div>
                    ${
                      currentUser
                        ? `
                    <div class="post-add-comment">
                        <input type="text" class="comment-input" placeholder="Tambahkan komentar..." data-post-id="${post.id}">
                        <button class="comment-submit" data-post-id="${post.id}">Kirim</button>
                    </div>
                    `
                        : ""
                    }
                </div>
            `;

        // Add event listeners for comment submission
        const commentSubmit = postDetail.querySelector(".comment-submit");
        if (commentSubmit) {
          commentSubmit.addEventListener("click", handleCommentSubmit);
        }

        // Add event listener for comment input enter key
        const commentInput = postDetail.querySelector(".comment-input");
        if (commentInput) {
          commentInput.addEventListener("keypress", (e) => {
            if (e.key === "Enter") {
              handleCommentSubmit(e);
            }
          });
        }

        modal.style.display = "flex";
      }

      // Load chat users
      function loadChatUsers() {
        if (!currentUser) return;

        // Clear existing users
        chatUsers.innerHTML = "";

        // Get users that have chats with current user
        const chatPartners = [];

        chats.forEach((chat) => {
          if (chat.participants.includes(currentUser.id)) {
            const partnerId = chat.participants.find(
              (id) => id !== currentUser.id
            );
            const partner = users.find((u) => u.id === partnerId);
            if (partner && !chatPartners.some((u) => u.id === partner.id)) {
              chatPartners.push(partner);
            }
          }
        });

        // Add other users that don't have chats yet
        users.forEach((user) => {
          if (
            user.id !== currentUser.id &&
            !chatPartners.some((u) => u.id === user.id) &&
            user.username !== "demo"
          ) {
            // Exclude demo user for simplicity
            chatPartners.push(user);
          }
        });

        if (chatPartners.length === 0) {
          chatUsers.innerHTML =
            '<div class="text-center">Tidak ada pengguna untuk diajak chat</div>';
          return;
        }

        // Create user elements
        chatPartners.forEach((user) => {
          const userElement = document.createElement("div");
          userElement.className = "chat-user";
          userElement.setAttribute("data-user-id", user.id);
          userElement.innerHTML = `
                    <img src="${user.avatar}" alt="${
            user.username
          }" class="chat-user-avatar">
                    <div class="chat-user-name">${user.username}</div>
                    ${
                      user.isOnline
                        ? '<div class="online-indicator"></div>'
                        : ""
                    }
                `;

          userElement.addEventListener("click", () => {
            // Set active user
            document.querySelectorAll(".chat-user").forEach((u) => {
              u.classList.remove("active");
            });
            userElement.classList.add("active");

            // Load chat messages
            loadChatMessages(user.id);
            currentChatUser = user;
          });

          chatUsers.appendChild(userElement);
        });

        // Auto select first user if none selected
        if (!currentChatUser && chatPartners.length > 0) {
          const firstUser = chatPartners[0];
          document
            .querySelector(`.chat-user[data-user-id="${firstUser.id}"]`)
            .click();
        }
      }

      // Load chat messages for a specific user
      function loadChatMessages(userId) {
        if (!currentUser) return;

        // Clear existing messages
        chatMessages.innerHTML = "";

        // Find chat between current user and selected user
        const chat = chats.find(
          (c) =>
            c.participants.includes(currentUser.id) &&
            c.participants.includes(userId)
        );

        if (!chat || chat.messages.length === 0) {
          chatMessages.innerHTML =
            '<div class="text-center">Tidak ada pesan</div>';
          return;
        }

        // Sort messages by timestamp
        const sortedMessages = [...chat.messages].sort(
          (a, b) => a.timestamp - b.timestamp
        );

        // Deteksi pesan baru dari user lain
        let lastMessageId = chatMessages.getAttribute("data-last-message-id");
        let newLastMessageId = null;
        let foundNewMessage = false;
        let newMessageSender = null;
        let newMessageText = null;

        sortedMessages.forEach((message, idx) => {
          const messageElement = document.createElement("div");
          messageElement.className = `chat-message ${
            message.senderId === currentUser.id ? "own" : ""
          }`;

          const sender = users.find((u) => u.id === message.senderId);
          if (!sender) return;

          messageElement.innerHTML = `
                    <img src="${sender.avatar}" alt="${
            sender.username
          }" class="chat-message-avatar">
                    <div class="chat-message-content">
                        <div class="chat-message-text">${message.text}</div>
                        <div class="chat-message-time">${formatTime(
                          message.timestamp,
                          true
                        )}</div>
                    </div>
                `;

          chatMessages.appendChild(messageElement);

          // Simpan id pesan terakhir
          if (idx === sortedMessages.length - 1) {
            newLastMessageId = message.id;
            // Deteksi pesan baru dari user lain
            if (
              lastMessageId &&
              message.id != lastMessageId &&
              message.senderId !== currentUser.id
            ) {
              foundNewMessage = true;
              newMessageSender = sender.username;
              newMessageText = message.text;
            }
          }
        });

        // Jika ada pesan baru dari user lain, tampilkan toast notifikasi
        if (foundNewMessage && newMessageSender && newMessageText) {
          showToastNotification(
            `Pesan baru dari <b>${newMessageSender}</b>: ${newMessageText}`
          );
        }

        // Update id pesan terakhir
        if (newLastMessageId) {
          chatMessages.setAttribute("data-last-message-id", newLastMessageId);
        }

        // Scroll to bottom
        chatMessages.scrollTop = chatMessages.scrollHeight;
      }

      // Fungsi untuk menampilkan toast notifikasi
      function showToastNotification(message) {
        const toast = document.getElementById("toastNotification");
        const toastMsg = document.getElementById("toastMessage");
        toastMsg.innerHTML = message;
        toast.style.display = "flex";
        setTimeout(() => {
          toast.style.display = "none";
        }, 3500);
      }

      // Send a chat message
      function sendChatMessage() {
        if (!currentUser || !currentChatUser || !chatInput.value.trim()) return;

        // Find or create chat
        let chat = chats.find(
          (c) =>
            c.participants.includes(currentUser.id) &&
            c.participants.includes(currentChatUser.id)
        );

        if (!chat) {
          chat = {
            id: new Date().getTime(),
            participants: [currentUser.id, currentChatUser.id],
            messages: [],
          };
          chats.push(chat);
        }

        // Add new message
        const newMessage = {
          id: new Date().getTime(),
          senderId: currentUser.id,
          text: chatInput.value.trim(),
          timestamp: new Date().getTime(),
        };

        chat.messages.push(newMessage);

        // Clear input
        chatInput.value = "";

        // Reload messages
        loadChatMessages(currentChatUser.id);

        // Save to localStorage
        localStorage.setItem("chats", JSON.stringify(chats));

        // Update notification badge
        updateChatNotification();
      }

      // Update chat notification badge
      function updateChatNotification() {
        if (!currentUser) return;

        let unreadCount = 0;

        // Count unread messages (for demo, we'll just count recent messages)
        chats.forEach((chat) => {
          if (chat.participants.includes(currentUser.id)) {
            // Get the last message
            const lastMessage = chat.messages[chat.messages.length - 1];
            if (lastMessage && lastMessage.senderId !== currentUser.id) {
              // If message is from last 5 minutes, consider it unread
              if (
                new Date().getTime() - lastMessage.timestamp <
                5 * 60 * 1000
              ) {
                unreadCount++;
              }
            }
          }
        });

        if (unreadCount > 0) {
          chatNotification.textContent = unreadCount > 9 ? "9+" : unreadCount;
          chatNotification.classList.remove("hidden");
        } else {
          chatNotification.classList.add("hidden");
        }
      }

      // Check if current user liked a post
      function isPostLiked(post) {
        return (
          currentUser && post.likedBy && post.likedBy.includes(currentUser.id)
        );
      }

      // Handle like button click
      function handleLike(e) {
        if (!currentUser) {
          alert("Anda harus login untuk menyukai postingan");
          showPage("loginPage");
          return;
        }

        const postId = parseInt(e.currentTarget.getAttribute("data-post-id"));
        const post = posts.find((p) => p.id === postId);

        if (post) {
          // Initialize likedBy array if not exists
          if (!post.likedBy) post.likedBy = [];

          // Toggle like
          if (isPostLiked(post)) {
            post.likes--;
            post.likedBy = post.likedBy.filter((id) => id !== currentUser.id);
            e.currentTarget.classList.remove("liked");
          } else {
            post.likes++;
            post.likedBy.push(currentUser.id);
            e.currentTarget.classList.add("liked");
            e.currentTarget.classList.add("heart-animation");
            setTimeout(() => {
              e.currentTarget.classList.remove("heart-animation");
            }, 500);
          }

          // Update like count display
          const likesElement = e.currentTarget
            .closest(".post")
            .querySelector(".post-likes");
          likesElement.textContent = `${post.likes} suka`;

          // Save to localStorage
          localStorage.setItem("posts", JSON.stringify(posts));
        }
      }

      // Handle comment submission
      function handleCommentSubmit(e) {
        if (!currentUser) {
          alert("Anda harus login untuk berkomentar");
          showPage("loginPage");
          return;
        }

        const postId = parseInt(e.currentTarget.getAttribute("data-post-id"));
        const post = posts.find((p) => p.id === postId);
        let commentInput;

        if (e.target.classList.contains("comment-submit")) {
          commentInput = e.target.previousElementSibling;
        } else {
          commentInput = e.target;
        }

        const commentText = commentInput.value.trim();

        if (commentText && post) {
          // Add new comment
          const newComment = {
            id: new Date().getTime(), // Simple ID generation
            userId: currentUser.id,
            username: currentUser.username,
            text: commentText,
          };

          post.comments.push(newComment);

          // Clear input
          commentInput.value = "";

          // Reload posts to show the new comment
          if (modal.style.display === "flex") {
            showPostDetail(postId);
          } else {
            loadPosts();
          }

          // Save to localStorage
          localStorage.setItem("posts", JSON.stringify(posts));
        }
      }

      // Handle delete comment
      function handleDeleteComment(e) {
        const postId = parseInt(e.currentTarget.getAttribute("data-post-id"));
        const commentId = parseInt(
          e.currentTarget.getAttribute("data-comment-id")
        );
        const post = posts.find((p) => p.id === postId);

        if (post) {
          // Find comment index
          const commentIndex = post.comments.findIndex(
            (c) => c.id === commentId
          );

          if (commentIndex !== -1) {
            // Remove comment
            post.comments.splice(commentIndex, 1);

            // Reload posts
            if (modal.style.display === "flex") {
              showPostDetail(postId);
            } else {
              loadPosts();
            }

            // Save to localStorage
            localStorage.setItem("posts", JSON.stringify(posts));
          }
        }
      }

      // Format timestamp to relative time
      function formatTime(timestamp, short = false) {
        const now = new Date().getTime();
        const diff = now - timestamp;

        const seconds = Math.floor(diff / 1000);
        const minutes = Math.floor(diff / 60000);
        const hours = Math.floor(diff / 3600000);
        const days = Math.floor(diff / 86400000);

        if (short) {
          if (seconds < 60) return "baru saja";
          if (minutes < 60) return `${minutes}m`;
          if (hours < 24) return `${hours}j`;
          if (days < 7) return `${days}h`;
          return new Date(timestamp).toLocaleDateString("id-ID", {
            day: "numeric",
            month: "short",
          });
        }

        if (seconds < 60) return "Baru saja";
        if (minutes < 60) return `${minutes} menit yang lalu`;
        if (hours < 24) return `${hours} jam yang lalu`;
        if (days < 7) return `${days} hari yang lalu`;

        return new Date(timestamp).toLocaleDateString("id-ID");
      }

      // Handle profile avatar edit
      function editProfileAvatar() {
        avatarUpload.value = "";
        avatarModal.style.display = "flex";
      }

      // Save new profile avatar
      function saveProfileAvatar() {
        if (!avatarUpload.files || !avatarUpload.files[0]) {
          alert("Pilih gambar terlebih dahulu");
          return;
        }
        const file = avatarUpload.files[0];
        const reader = new FileReader();
        reader.onload = function (e) {
          const newAvatar = e.target.result;
          currentUser.avatar = newAvatar;
          // Update avatar di array users
          const userIndex = users.findIndex((u) => u.id === currentUser.id);
          if (userIndex !== -1) {
            users[userIndex].avatar = newAvatar;
          }
          document.getElementById("profileAvatar").src = newAvatar;
          // Save to localStorage
          localStorage.setItem("users", JSON.stringify(users));
          localStorage.setItem("currentUser", JSON.stringify(currentUser));
          avatarModal.style.display = "none";
          alert("Foto profil berhasil diubah!");
        };
        reader.readAsDataURL(file);
      }

      // Hapus foto profil
      function deleteProfileAvatar() {
        const defaultAvatar = "https://via.placeholder.com/100";
        currentUser.avatar = defaultAvatar;
        const userIndex = users.findIndex((u) => u.id === currentUser.id);
        if (userIndex !== -1) {
          users[userIndex].avatar = defaultAvatar;
        }
        document.getElementById("profileAvatar").src = defaultAvatar;
        localStorage.setItem("users", JSON.stringify(users));
        localStorage.setItem("currentUser", JSON.stringify(currentUser));
        avatarModal.style.display = "none";
        alert("Foto profil berhasil dihapus!");
      }

      // Handle profile bio edit
      function editProfileBio() {
        if (!currentUser || viewingProfileUserId) return;

        profileBio.classList.add("editing");
        profileBioEdit.value = currentUser.bio || "";
        profileBioActions.classList.remove("hidden");
      }

      // Save profile bio
      function saveProfileBio() {
        if (!currentUser || viewingProfileUserId) return;

        currentUser.bio = profileBioEdit.value;
        profileBioText.textContent = currentUser.bio || "Tidak ada bio";

        // Save to localStorage
        localStorage.setItem("users", JSON.stringify(users));
        localStorage.setItem("currentUser", JSON.stringify(currentUser));

        cancelProfileBioEdit();
      }

      // Cancel profile bio edit
      function cancelProfileBioEdit() {
        profileBio.classList.remove("editing");
        profileBioActions.classList.add("hidden");
      }

      // Simulate Google login/registration
      function handleGoogleAuth(isLogin = false) {
        // Show loading state
        const button = isLogin ? googleLogin : googleRegister;
        const originalText = button.innerHTML;
        button.innerHTML = '<div class="spinner"></div>';
        button.disabled = true;

        // Simulate API call delay
        setTimeout(() => {
          // Generate random user data for demo
          const randomId = new Date().getTime();
          const randomNum = Math.floor(Math.random() * 1000);
          const googleEmail = `user${randomNum}@gmail.com`;
          // Check if user already exists (by email)
          let existingUser = users.find(
            (u) => u.email === googleEmail && u.isGoogleUser
          );
          if (existingUser) {
            // Always get the latest user data from users array
            currentUser = { ...existingUser };
            localStorage.setItem("currentUser", JSON.stringify(currentUser));
            updateUI();
            showPage("homePage");
            alert(`Selamat datang kembali, ${existingUser.username}!`);
          } else {
            // Register new user
            const googleUser = {
              id: randomId,
              email: googleEmail,
              username: `google_user_${randomNum}`,
              password: "", // No password for Google users
              avatar: `https://i.pravatar.cc/150?u=${randomId}`,
              bio: "Pengguna Google",
              followers: Math.floor(Math.random() * 100),
              following: Math.floor(Math.random() * 50),
              isGoogleUser: true,
              isOnline: true,
              followersList: [],
              followingList: [],
            };
            users.push(googleUser);
            currentUser = { ...googleUser };
            // Save to localStorage
            localStorage.setItem("users", JSON.stringify(users));
            localStorage.setItem("currentUser", JSON.stringify(currentUser));
            updateUI();
            showPage("homePage");
            alert(
              `Akun Google berhasil dibuat! Selamat datang, ${googleUser.username}`
            );
          }
          // Restore button state
          button.innerHTML = originalText;
          button.disabled = false;
        }, 1500);
      }

      // Event Listeners
      document.getElementById("loginBtn").addEventListener("click", (e) => {
        e.preventDefault();
        showPage("loginPage");
      });

      document.getElementById("registerBtn").addEventListener("click", (e) => {
        e.preventDefault();
        showPage("registerPage");
      });

      document.getElementById("goToRegister").addEventListener("click", (e) => {
        e.preventDefault();
        showPage("registerPage");
      });

      document.getElementById("goToLogin").addEventListener("click", (e) => {
        e.preventDefault();
        showPage("loginPage");
      });

      logoutBtn.addEventListener("click", () => {
        currentUser = null;
        localStorage.removeItem("currentUser");
        updateUI();
      });

      // Google auth buttons
      googleLogin.addEventListener("click", () => {
        handleGoogleAuth(true);
      });

      googleRegister.addEventListener("click", () => {
        handleGoogleAuth(false);
      });

      // Chat toggle
      chatToggle.addEventListener("click", () => {
        chatContainer.classList.toggle("open");
        if (chatContainer.classList.contains("open")) {
          chatNotification.classList.add("hidden");
        }
      });

      // Chat close
      chatClose.addEventListener("click", () => {
        chatContainer.classList.remove("open");
      });

      // Chat send message
      chatSend.addEventListener("click", sendChatMessage);

      // Chat input enter key
      chatInput.addEventListener("keypress", (e) => {
        if (e.key === "Enter") {
          sendChatMessage();
        }
      });

      // Profile avatar edit
      profileAvatarEdit.addEventListener("click", editProfileAvatar);

      // Save profile avatar
      avatarSave.addEventListener("click", saveProfileAvatar);
      document
        .getElementById("avatarDelete")
        .addEventListener("click", deleteProfileAvatar);

      // Profile bio edit
      profileBio.addEventListener("click", editProfileBio);

      // Save profile bio
      profileBioSave.addEventListener("click", saveProfileBio);

      // Cancel profile bio edit
      profileBioCancel.addEventListener("click", cancelProfileBioEdit);

      // Follow button
      followButton.addEventListener("click", handleFollow);

      // Top navigation menu
      navTopMenuItems.forEach((item) => {
        item.addEventListener("click", (e) => {
          e.preventDefault();
          const page = item.getAttribute("data-page");

          if (page === "uploadPage" && !currentUser) {
            alert("Anda harus login untuk mengunggah foto");
            showPage("loginPage");
            return;
          }

          if (page === "profilePage" && !currentUser) {
            alert("Anda harus login untuk melihat profil");
            showPage("loginPage");
            return;
          }

          showPage(page);
        });
      });

      // Login form submission
      loginForm.addEventListener("submit", (e) => {
        e.preventDefault();
        const email = document.getElementById("loginEmail").value;
        const password = document.getElementById("loginPassword").value;

        // Find user
        const user = users.find(
          (u) =>
            (u.email === email || u.username === email) &&
            u.password === password
        );

        if (user) {
          // Ambil data user terbaru dari array users (by id)
          const freshUser = users.find((u) => u.id === user.id);
          currentUser = freshUser ? { ...freshUser } : user;
          localStorage.setItem("currentUser", JSON.stringify(currentUser));
          updateUI();
          showPage("homePage");
        } else {
          alert("Email/username atau password salah");
        }
      });

      // Register form submission
      registerForm.addEventListener("submit", (e) => {
        e.preventDefault();
        const email = document.getElementById("registerEmail").value;
        const username = document.getElementById("registerUsername").value;
        const password = document.getElementById("registerPassword").value;

        // Check if user already exists
        if (users.some((u) => u.email === email)) {
          alert("Email sudah terdaftar");
          return;
        }

        if (users.some((u) => u.username === username)) {
          alert("Username sudah digunakan");
          return;
        }

        // Create new user
        const newUser = {
          id: new Date().getTime(), // Simple ID generation
          email,
          username,
          password,
          avatar: "https://via.placeholder.com/100",
          bio: "",
          followers: 0,
          following: 0,
          isOnline: true,
          followersList: [],
          followingList: [],
        };

        users.push(newUser);
        currentUser = newUser;

        // Save to localStorage
        localStorage.setItem("users", JSON.stringify(users));
        localStorage.setItem("currentUser", JSON.stringify(currentUser));

        updateUI();
        showPage("homePage");
      });

      // Upload form submission
      uploadForm.addEventListener("submit", (e) => {
        e.preventDefault();

        if (!currentUser) {
          alert("Anda harus login untuk mengunggah foto");
          showPage("loginPage");
          return;
        }

        const caption = document.getElementById("postCaption").value;
        const imageInput = document.getElementById("postImage");

        if (!imageInput.files || !imageInput.files[0]) {
          alert("Pilih gambar terlebih dahulu");
          return;
        }

        const file = imageInput.files[0];
        const reader = new FileReader();
        reader.onload = function (e) {
          const newPost = {
            id: new Date().getTime(), // Simple ID generation
            userId: currentUser.id,
            image: e.target.result,
            caption,
            likes: 0,
            likedBy: [],
            comments: [],
            timestamp: new Date().getTime(),
          };
          posts.push(newPost);
          // Save to localStorage
          localStorage.setItem("posts", JSON.stringify(posts));
          // Reset form
          uploadForm.reset();
          // Show home page
          showPage("homePage");
          alert("Postingan berhasil diunggah!");
        };
        reader.readAsDataURL(file);
      });

      // Bottom navigation click
      navItems.forEach((item) => {
        item.addEventListener("click", () => {
          const page = item.getAttribute("data-page");

          if (page === "uploadPage" && !currentUser) {
            alert("Anda harus login untuk mengunggah foto");
            showPage("loginPage");
            return;
          }

          if (page === "profilePage" && !currentUser) {
            alert("Anda harus login untuk melihat profil");
            showPage("loginPage");
            return;
          }

          showPage(page);
        });
      });

      // Modal close
      modalClose.addEventListener("click", () => {
        modal.style.display = "none";
      });

      // Close modal when clicking outside
      window.addEventListener("click", (e) => {
        if (e.target === modal || e.target === avatarModal) {
          modal.style.display = "none";
          avatarModal.style.display = "none";
        }
      });

      // Dark mode toggle
      themeToggle.addEventListener("click", () => {
        const isDark =
          document.documentElement.getAttribute("data-theme") === "dark";
        document.documentElement.setAttribute(
          "data-theme",
          isDark ? "light" : "dark"
        );
        themeToggle.innerHTML = isDark
          ? '<i class="fas fa-moon"></i>'
          : '<i class="fas fa-sun"></i>';
        localStorage.setItem("theme", isDark ? "light" : "dark");
      });

      // Check saved theme
      const savedTheme = localStorage.getItem("theme");
      if (savedTheme) {
        document.documentElement.setAttribute("data-theme", savedTheme);
        themeToggle.innerHTML =
          savedTheme === "dark"
            ? '<i class="fas fa-sun"></i>'
            : '<i class="fas fa-moon"></i>';
      }

      // Initialize the app
      init();
    </script>
  </body>
</html>
